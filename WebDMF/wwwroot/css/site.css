/* ==========================================================================
   1. CẤU HÌNH BIẾN & THEME
   ========================================================================== */
:root {
    --focus-ring-color: white;
    --body-bg: #f8f9fa;
    --card-bg: #ffffff;
    --text-color: #212529;
    --card-radius: 16px;
}

[data-bs-theme="dark"] {
    --focus-ring-color: #0f172a;
    --body-bg: #0f172a;
    --card-bg: #1e293b;
    --text-color: #f8fafc;
}

html {
    font-size: 14px;
    position: relative;
    min-height: 100%;
}

@media (min-width: 768px) {
    html {
        font-size: 16px;
    }
}

body {
    margin-bottom: 60px;
    background-color: var(--body-bg);
    color: var(--text-color);
    transition: background-color 0.3s ease;
}

.btn:focus, .btn:active:focus, .btn-link.nav-link:focus, .form-control:focus, .form-check-input:focus {
    box-shadow: 0 0 0 0.1rem var(--focus-ring-color), 0 0 0 0.25rem #3b82f6;
}

/* ==========================================================================
   2. FIX LỖI MENU DROPDOWN BỊ CHE (CORE FIX)
   ========================================================================== */

/* QUY TẮC 1: MỞ KHÓA HIỂN THỊ */
.folder-card, .file-card, .card,
.card-body, .folder-body, .file-card-body,
.folder-cover, .card-header, .file-preview-area {
    overflow: visible !important;
}

/* QUY TẮC 2: CƠ CHẾ NỔI LÊN (Z-INDEX) */
.folder-card, .file-card, .card {
    position: relative !important;
    background-color: var(--card-bg);
    /* Chỉ transition transform và shadow, KHÔNG transition border-radius */
    transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.2s ease;
    /* Tạo stacking context mới để fix lỗi render */
    isolation: isolate;
}

    /* Hover hoặc đang mở menu -> Nổi lên */
    .folder-card:hover, .file-card:hover, .card:hover,
    .folder-card:focus-within, .file-card:focus-within, .card:focus-within,
    .folder-card:has(.show), .file-card:has(.show), .card:has(.show) {
        z-index: 1000 !important;
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
    }

/* Dropdown Menu */
.dropdown-menu {
    z-index: 9999 !important;
    margin-top: 6px !important;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.18) !important;
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 12px;
}

.table-responsive {
    overflow-x: auto;
    overflow-y: visible !important;
    min-height: 250px;
}

/* ==========================================================================
   3. FIX LỖI BO GÓC (BORDER RADIUS)
   Ép các thẻ con tự bo góc vì thẻ cha overflow:visible
   ========================================================================== */

/* Khung cha */
.folder-card, .file-card, .card {
    border-radius: var(--card-radius) !important;
    border: 1px solid rgba(0,0,0,0.06);
    /* Mẹo: Viền trong suốt giúp khử răng cưa ngay lập tức */
    outline: 1px solid transparent;
}

/* --- BO GÓC TRÊN (QUAN TRỌNG) --- */
.folder-cover,
.file-preview-area,
.card-header,
.card-img-top {
    border-top-left-radius: var(--card-radius) !important;
    border-top-right-radius: var(--card-radius) !important;
    background-clip: padding-box;
    /* Fix lỗi lem pixel trắng ở góc */
    margin-top: -1px;
    margin-left: -1px;
    margin-right: -1px;
    width: calc(100% + 2px);
}

    /* Bo ảnh bên trong */
    .folder-cover img,
    .file-preview-area img,
    .file-preview-area .icon-box {
        border-top-left-radius: var(--card-radius) !important;
        border-top-right-radius: var(--card-radius) !important;
    }

/* --- BO GÓC DƯỚI --- */
.folder-body,
.file-card-body,
.card-body:last-child,
.card-footer:last-child {
    border-bottom-left-radius: var(--card-radius) !important;
    border-bottom-right-radius: var(--card-radius) !important;
    background-color: var(--card-bg);
}

.office-preview-iframe, .file-preview-area img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.folder-card a, .file-card a {
    border-radius: inherit;
    text-decoration: none;
    color: inherit;
    display: block;
}

/* ==========================================================================
   4. FIX LỖI "NHẤP NHÁY" VUÔNG TRÒN (FLICKER FIX V2)
   Đã loại bỏ mask nặng, dùng will-change và transform hack
   ========================================================================== */

/* Ép GPU render ngay lập tức, không đợi CPU tính toán */
.folder-card, .file-card, .card {
    -webkit-transform-style: preserve-3d;
    transform-style: preserve-3d;
    will-change: transform, box-shadow; /* Báo trước cho trình duyệt */
}

/* Chống rung lắc và ép bo góc cứng cho nội dung bên trong */
.folder-cover, .file-preview-area, .card-header, .card-img-top {
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-transform: translateZ(0); /* Hack kích hoạt hardware acceleration */
    transform: translateZ(0);
}
